# Telegram Support Bot

Телеграм-бот для психологической поддержки. Когда пользователь делится расстраивающим событием из жизни, бот отвечает похожей поддерживающей историей из той же области жизни.

## Функции

- Принимает описание расстраивающих событий от пользователей
- Автоматически категоризирует события (работа, отношения, семья, здоровье и т.д.)
- Генерирует или выбирает похожую поддерживающую историю
- Сохраняет истории для повторного использования
- Предоставляет статистику обращений пользователя

## Технологии

- Node.js
- Telegram Bot API (node-telegram-bot-api)
- Supabase (база данных и хранение)
- Yandex Cloud API (генерация историй и категоризация)

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
   ```bash
   npm install
   ```

3. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```

4. Заполните переменные окружения в `.env`:

   ### Telegram Bot Token
   - Перейдите к [@BotFather](https://t.me/botfather) в Telegram
   - Создайте нового бота командой `/newbot`
   - Следуйте инструкциям и получите токен
   - Добавьте токен в `TELEGRAM_BOT_TOKEN`

   ### Supabase
   - Переменные Supabase уже настроены в вашем проекте
   - Скопируйте значения из файла `.env` в корне проекта

   ### Yandex Cloud
   - Создайте аккаунт на [Yandex Cloud](https://cloud.yandex.com)
   - Создайте API ключ в разделе управления аккаунтом
   - Создайте проект (Folder) и скопируйте его ID
   - Добавьте `YANDEX_API_KEY` и `YANDEX_FOLDER_ID` в `.env`

## Запуск

### Режим разработки (с автоперезагрузкой):
```bash
npm run dev
```

### Производственный режим:
```bash
npm start
```

### Проверка кода:
```bash
npm run build
```

## Команды бота

- `/start` - Начать работу с ботом
- `/help` - Показать справку
- `/stats` - Статистика обращений пользователя

## Структура проекта

```
telegram-support-bot/
├── bot.js              # Основной файл бота
├── config.js           # Конфигурация Supabase
├── database.js         # Функции работы с БД
├── storyGenerator.js   # Генерация историй с помощью Yandex Cloud
├── package.json        # Зависимости проекта
├── .env.example        # Пример переменных окружения
└── README.md          # Документация
```

## База данных

Схема базы данных включает три таблицы:

- `users` - Информация о пользователях бота
- `user_events` - События, которыми делились пользователи
- `stories` - Сохранённые истории для ответов

## Как это работает

1. Пользователь отправляет сообщение с описанием расстраивающего события
2. Бот использует Yandex Cloud API для определения категории события
3. Бот проверяет, есть ли подходящая история в базе данных
4. Если история есть - использует её, если нет - генерирует новую с помощью Yandex Cloud
5. Новые истории сохраняются для повторного использования
6. Бот отправляет поддерживающую историю пользователю

## Категории событий

- Работа
- Отношения
- Семья
- Здоровье
- Финансы
- Образование
- Дружба
- Личное развитие
- Общее

## Безопасность

- Используется Supabase Row Level Security (RLS)
- API ключи хранятся в переменных окружения
- Бот использует service role для доступа к базе данных
